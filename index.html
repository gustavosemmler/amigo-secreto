<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Amigo Secreto üéÑ</title>
  <meta name="theme-color" content="#13060a" />

  <style>
    :root{
      --bg1:#13060a;
      --bg2:#2a0a12;
      --card: rgba(16, 6, 10, .72);
      --border: rgba(255,255,255,.16);

      --text:#fff7f9;
      --muted: rgba(255,247,249,.78);

      --red:#ff2e4f;
      --red2:#c50d2a;
      --gold:#ffd166;

      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(900px 520px at 16% 18%, rgba(255,46,79,.22) 0%, transparent 55%),
        radial-gradient(900px 520px at 84% 28%, rgba(255,209,102,.14) 0%, transparent 55%),
        radial-gradient(900px 620px at 50% 92%, rgba(197,13,42,.18) 0%, transparent 62%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* Neve */
    #snow{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      opacity: .95;
    }

    .wrap{
      min-height: 100%;
      display:grid;
      place-items:center;
      padding: 18px 12px 28px;
      position:relative;
      z-index: 1;
    }

    .card{
      width: min(760px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position: relative;
    }

    /* PAPEL NATALINO (sutil) */
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.35;
      background:
        repeating-linear-gradient(
          135deg,
          rgba(255,255,255,.06) 0px,
          rgba(255,255,255,.06) 10px,
          rgba(255,46,79,.06) 10px,
          rgba(255,46,79,.06) 20px
        );
      mix-blend-mode: overlay;
    }
    /* Texturinha/gr√£o */
    .card::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.18;
      background-image:
        radial-gradient(1px 1px at 15% 20%, rgba(255,255,255,.55) 0, transparent 60%),
        radial-gradient(1px 1px at 75% 30%, rgba(255,255,255,.45) 0, transparent 60%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.35) 0, transparent 60%),
        radial-gradient(1px 1px at 60% 70%, rgba(255,255,255,.40) 0, transparent 60%);
      filter: blur(.2px);
    }

    .top, .main, .footer{
      position: relative; /* fica acima do papel */
      z-index: 1;
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 14px 14px 10px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--muted);
      font-size: 13px;
      letter-spacing:.2px;
      user-select:none;
    }

    .dot{
      width:9px;height:9px;border-radius:99px;
      background: radial-gradient(circle at 30% 30%, #fff, #fff0 55%),
                  linear-gradient(140deg, var(--gold), var(--red));
      box-shadow: 0 0 0 4px rgba(255,209,102,.12);
    }

    .musicBtn{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 9px 12px;
      font-weight: 900;
      letter-spacing:.2px;
      background: linear-gradient(160deg, rgba(255,46,79,.22), rgba(255,46,79,.10));
      border:1px solid rgba(255,46,79,.28);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .musicBtn:active{ transform: translateY(1px); }

    .main{ padding: 4px 14px 16px; }

    h1{
      margin: 6px 0 10px;
      font-size: 34px;
      line-height: 1.1;
      letter-spacing: -.7px;
    }

    .sub{
      margin: 0 0 14px;
      color: var(--muted);
      line-height: 1.6;
      font-size: 15.5px;
    }

    .stage{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      padding: 12px;
      position:relative;
      overflow:hidden;
    }

    .stepTitle{
      font-weight: 900;
      letter-spacing:.2px;
      margin: 0 0 8px;
      font-size: 14px;
      color: rgba(255,247,249,.92);
    }

    .pistas{ display:grid; gap:10px; }
    .pista{
      display:flex; gap:10px; align-items:flex-start;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
    }
    .num{
      width: 30px; height: 30px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      font-weight: 1000;
      flex: 0 0 auto;
    }
    .pista p{
      margin:0;
      color: var(--muted);
      font-size: 14.5px;
      line-height: 1.45;
    }

    .btnRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top: 12px;
    }

    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 1000;
      letter-spacing:.2px;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, filter .2s ease;
      width:100%;
    }
    @media (min-width: 520px){ .btn{ width:auto; } }
    .btn:active{ transform: translateY(1px); }
    .btn:hover{ filter: brightness(1.06); }

    .ghost{
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
    }

    .primary{
      background: linear-gradient(160deg, var(--red), var(--red2));
      color: #fff;
      border: 1px solid rgba(255,46,79,.28);
    }

    .gold{
      background: linear-gradient(160deg, var(--gold), #ffe7aa);
      color: #2b0b12;
      border: 1px solid rgba(255,209,102,.35);
    }

    .reveal{
      display:none;
      margin-top: 12px;
      animation: pop .45s ease both;
    }
    @keyframes pop{
      from{ opacity:0; transform: translateY(10px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .bigCard{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(160deg, rgba(255,46,79,.16), rgba(255,255,255,.04));
      padding: 14px;
    }

    .who{
      margin:0;
      color: var(--muted);
      font-size: 13.5px;
    }
    .name{
      margin: 4px 0 0;
      font-size: 22px;
      font-weight: 1100;
      letter-spacing:.2px;
    }
    .tag{
      display:inline-flex;
      margin-top: 8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: var(--muted);
      font-size: 12.5px;
    }

    .msg{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      line-height: 1.65;
      font-size: 14.5px;
    }

    .voucher{
      margin-top: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,209,102,.30);
      background: linear-gradient(160deg, rgba(255,209,102,.18), rgba(255,46,79,.10));
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    .voucherTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .voucherTitle{
      font-weight: 1100;
      letter-spacing:.2px;
    }
    .amount{
      font-size: 22px;
      font-weight: 1200;
      white-space:nowrap;
    }
    .voucherSmall{
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
      line-height: 1.5;
    }

    /* confetti */
    .confetti{ position:absolute; inset:0; pointer-events:none; display:none; overflow:hidden; }
    .confetti i{
      position:absolute;
      width: 10px; height: 16px;
      opacity:.95;
      transform: translateY(-20px) rotate(0deg);
      animation: fall 1.25s ease-in forwards;
      border-radius: 3px;
      mix-blend-mode: screen;
      will-change: transform, opacity;
    }
    @keyframes fall{ to{ transform: translateY(760px) rotate(720deg); opacity:0; } }

    .footer{
      padding: 12px 14px 14px;
      text-align:center;
      color: rgba(255,247,249,.75);
      font-size: 12.5px;
      border-top: 1px solid rgba(255,255,255,.12);
    }
  </style>
</head>

<body>
  <canvas id="snow"></canvas>

  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="pill"><span class="dot"></span> Amigo Secreto</div>
        <button class="musicBtn" id="musicToggle" type="button">üéµ M√∫sica</button>
      </div>

      <div class="main">
        <h1>Quem ser√° que eu tirei? üéÅ</h1>
        <p class="sub">Vamos sanar sua curiosidade:</p>

        <div class="stage">
          <div class="confetti" id="confetti" aria-hidden="true"></div>

          <div class="stepTitle" id="stepTitle">Pista 1 de 6</div>
          <div class="pistas" id="pistas"></div>

          <div class="btnRow">
            <button class="btn ghost" id="nextHint">Pr√≥xima pista</button>
            <button class="btn primary" id="revealBtn">REVELAR</button>
          </div>

          <div class="reveal" id="reveal">
            <div class="bigCard">
              <p class="who">Eu tirei‚Ä¶</p>
              <div class="name" id="targetName">Tainah Bonazzi ‚ú®</div>
              <div class="tag">üíõ minha priminha do cora√ß√£o</div>

              <div class="msg" id="message"></div>

              <div class="voucher">
                <div class="voucherTop">
                  <div>
                    <div class="voucherTitle">Vale-presente para ajudar no seu EBOOK AMAZON</div>
                    <div class="voucherSmall">Pode chamar o gugu que transfiro na hora hehe</div>
                  </div>
                  <div class="amount" id="amount">R$ 120</div>
                </div>

                <div class="btnRow">
                  <a class="btn gold" id="whatsBtn" href="#" target="_blank" rel="noopener">Me chamar no WhatsApp</a>
                  <button class="btn ghost" id="copyMsg">Copiar mensagem</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="footer">feito por mim üéÑ</div>
    </div>
  </div>

  <script>
    // =========================
    // NEVE CAINDO (canvas)
    // =========================
    (function snowInit(){
      const canvas = document.getElementById("snow");
      if (!canvas) return;
      const ctx = canvas.getContext("2d");
      let w, h, flakes = [];

      function resize(){
        const dpr = window.devicePixelRatio || 1;
        w = canvas.width  = Math.floor(window.innerWidth * dpr);
        h = canvas.height = Math.floor(window.innerHeight * dpr);
        canvas.style.width = window.innerWidth + "px";
        canvas.style.height = window.innerHeight + "px";

        const count = Math.min(170, Math.floor(window.innerWidth / 6));
        flakes = Array.from({length: count}, () => makeFlake(true, dpr));
      }

      function makeFlake(init, dpr){
        return {
          x: Math.random() * w,
          y: init ? Math.random() * h : -20 * dpr,
          r: (Math.random() * 2.2 + 0.8) * dpr,
          sp: (Math.random() * 1.5 + 0.8) * dpr,
          drift: (Math.random() * 0.9 + 0.2) * dpr,
          alpha: Math.random() * 0.45 + 0.18,
          phase: Math.random() * Math.PI * 2
        };
      }

      function tick(){
        ctx.clearRect(0,0,w,h);
        for (let i=0;i<flakes.length;i++){
          const f = flakes[i];
          f.phase += 0.012;
          f.y += f.sp;
          f.x += Math.sin(f.phase) * f.drift;

          if (f.y > h + 30) flakes[i] = makeFlake(false, window.devicePixelRatio||1);

          ctx.globalAlpha = f.alpha;
          ctx.beginPath();
          ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
          ctx.fillStyle = "#fff";
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        requestAnimationFrame(tick);
      }

      window.addEventListener("resize", resize);
      resize();
      requestAnimationFrame(tick);
    })();

    // =========================
    // CONTE√öDO
    // =========================
    const CONFIG = {
      targetName: "Tainah Bonazzi",
      voucherAmount: "R$ 120",
      hints: [
        "Extremamente inteligente e engra√ßada üòÑ",
        "Tenho uma admira√ß√£o gigantesca pelo jeito dela ser, j√° me deu muitas li√ß√µes e dicas valiosas üíõ",
        "Nunca ganha de mim nos jogos üéÆ",
        "Eu tenho muito orgulho da pessoa que ela √© ‚ú®",
        "VIAJA PRA CARA*** ‚úàÔ∏è",
        "E‚Ä¶ √© minha priminha do cora√ß√£o ü´∂"
      ],
      message:
        "Tainah‚Ä¶ isso aqui √© simples, mas √© de cora√ß√£o. " +
        "Eu tenho muito orgulho de voc√™ e de tudo que voc√™ √©. " +
        "Feliz Natal e que Deus aben√ßoe SEMPRE sua vida, priminha! üéÑ‚ú®üíõ",
      whatsappToGustavo: "5511977840839"
    };

    // =========================
    // HELPERS
    // =========================
    function $(id){ return document.getElementById(id); }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }

    // =========================
    // UI SETUP
    // =========================
    const targetNameEl = $("targetName");
    const messageEl = $("message");
    const amountEl = $("amount");

    const pistasEl = $("pistas");
    const stepTitle = $("stepTitle");
    const nextHint = $("nextHint");
    const revealBtn = $("revealBtn");
    const reveal = $("reveal");
    const confetti = $("confetti");

    const whatsBtn = $("whatsBtn");
    const copyMsg = $("copyMsg");

    if (targetNameEl) targetNameEl.textContent = CONFIG.targetName + " ‚ú®";
    if (messageEl) messageEl.textContent = CONFIG.message;
    if (amountEl) amountEl.textContent = CONFIG.voucherAmount;

    const textToGustavo =
      `Oi Gustavo! üéÑ Vi o site do amigo secreto üòÑ Pode me transferir o vale de ${CONFIG.voucherAmount}? üíõ`;

    if (whatsBtn){
      whatsBtn.href = `https://wa.me/${CONFIG.whatsappToGustavo}?text=${encodeURIComponent(textToGustavo)}`;
    }

    if (copyMsg){
      copyMsg.addEventListener("click", async () => {
        try{
          await navigator.clipboard.writeText(textToGustavo);
          copyMsg.textContent = "Copiado ‚úÖ";
          setTimeout(() => copyMsg.textContent = "Copiar mensagem", 1200);
        }catch(e){
          const ta = document.createElement("textarea");
          ta.value = textToGustavo;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          copyMsg.textContent = "Copiado ‚úÖ";
          setTimeout(() => copyMsg.textContent = "Copiar mensagem", 1200);
        }
      });
    }

    // =========================
    // TOAST
    // =========================
    const toast = document.createElement("div");
    toast.style.position = "fixed";
    toast.style.inset = "0";
    toast.style.display = "none";
    toast.style.placeItems = "center";
    toast.style.padding = "14px";
    toast.style.background = "rgba(0,0,0,.55)";
    toast.style.backdropFilter = "blur(6px)";
    toast.style.zIndex = "9999";

    const toastCard = document.createElement("div");
    toastCard.style.width = "min(520px, 100%)";
    toastCard.style.borderRadius = "18px";
    toastCard.style.background = "rgba(16,6,10,.92)";
    toastCard.style.border = "1px solid rgba(255,255,255,.14)";
    toastCard.style.boxShadow = "0 24px 80px rgba(0,0,0,.55)";
    toastCard.style.padding = "14px";

    const toastMsg = document.createElement("div");
    toastMsg.style.whiteSpace = "pre-line";
    toastMsg.style.color = "rgba(255,247,249,.88)";
    toastMsg.style.lineHeight = "1.6";
    toastMsg.style.fontSize = "14.5px";

    const toastBtn = document.createElement("button");
    toastBtn.textContent = "ok üòå";
    toastBtn.style.marginTop = "12px";
    toastBtn.style.width = "100%";
    toastBtn.style.border = "1px solid rgba(255,255,255,.14)";
    toastBtn.style.background = "rgba(255,255,255,.08)";
    toastBtn.style.color = "#fff";
    toastBtn.style.padding = "12px 14px";
    toastBtn.style.borderRadius = "14px";
    toastBtn.style.fontWeight = "1000";
    toastBtn.style.cursor = "pointer";
    toastBtn.style.webkitTapHighlightColor = "transparent";
    toastBtn.addEventListener("click", () => toast.style.display = "none");

    toastCard.appendChild(toastMsg);
    toastCard.appendChild(toastBtn);
    toast.appendChild(toastCard);
    document.body.appendChild(toast);

    function showToast(msg){
      toastMsg.textContent = msg;
      toast.style.display = "grid";
    }

    // =========================
    // AUDIO (SFX + M√öSICA + BATIDINHA)
    // =========================
    const musicToggle = $("musicToggle");
    let audioCtx = null;
    let master = null;

    function ensureAudio(){
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      master = audioCtx.createGain();
      master.gain.value = 0.42; // MAIS ALTO
      master.connect(audioCtx.destination);
    }

    function tone(freq, ms, type="sine", gain=0.06){
      ensureAudio();
      if (audioCtx.state === "suspended") audioCtx.resume();

      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;

      const now = audioCtx.currentTime;
      const dur = ms/1000;

      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(gain, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + dur);

      osc.connect(g);
      g.connect(master);

      osc.start(now);
      osc.stop(now + dur + 0.02);
    }

    // Noise burst (clap)
    function noise(ms, gain=0.03){
      ensureAudio();
      if (audioCtx.state === "suspended") audioCtx.resume();

      const bufferSize = Math.max(1, Math.floor(audioCtx.sampleRate * (ms/1000)));
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<bufferSize;i++){
        data[i] = (Math.random()*2 - 1) * (1 - i/bufferSize);
      }

      const src = audioCtx.createBufferSource();
      const g = audioCtx.createGain();
      src.buffer = buffer;
      g.gain.value = gain;

      src.connect(g);
      g.connect(master);

      src.start();
    }

    // Batidinha (kick + clap) bem leve
    let beatTimer = null;
    let beatStep = 0;

    function kick(){
      // kick fake: oscilador descendo frequ√™ncia
      ensureAudio();
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();

      osc.type = "sine";
      osc.frequency.setValueAtTime(140, now);
      osc.frequency.exponentialRampToValueAtTime(55, now + 0.10);

      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.10, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);

      osc.connect(g);
      g.connect(master);

      osc.start(now);
      osc.stop(now + 0.14);
    }

    function beatTick(){
      // 4/4: kick no 1 e 3, clap no 2 e 4
      if (beatStep % 4 === 0) kick();
      if (beatStep % 4 === 2) noise(90, 0.018); // clapzinho
      beatStep = (beatStep + 1) % 4;

      // o beat acompanha o beatMs da m√∫sica
      beatTimer = setTimeout(beatTick, beatMs * 2); // semicolcheia? aqui √© "batida" maior (fica leve)
    }

    // Sons por pista (mais ‚Äúsininho‚Äù)
    const hintNotes = [523.25, 587.33, 659.25, 698.46, 783.99, 880.00];
    function sfxHint(n){
      const i = Math.min(n-1, hintNotes.length-1);
      const f = hintNotes[i];
      tone(f, 120, "sine", 0.05);
      tone(f*2, 70, "triangle", 0.028);
      setTimeout(()=>tone(f*3, 45, "sine", 0.016), 40);
    }

    function sfxError(){
      tone(220, 90, "square", 0.05);
      setTimeout(()=>tone(180, 120, "square", 0.05), 90);
    }

    function sfxReveal(){
      tone(523.25, 170, "triangle", 0.085);
      tone(659.25, 170, "triangle", 0.075);
      tone(783.99, 220, "triangle", 0.070);
      setTimeout(()=>tone(1046.5, 90, "sine", 0.032), 30);
    }

    // Vit√≥ria (vibe arcade)
    function sfxWin(){
      const seq = [
        [784, 120], [988, 120], [1175, 140],
        [1568, 160], [1175, 120], [1568, 220],
      ];
      let t = 0;
      for (const [f, ms] of seq){
        setTimeout(()=>tone(f, ms, "square", 0.055), t);
        setTimeout(()=>tone(f*2, Math.min(80, ms), "sine", 0.020), t+20);
        t += ms;
      }
    }

    // M√∫sica natalina (Jingle Bells) - loop + mais r√°pida
    let playingMusic = false;
    let musicTimer = null;
    let songIdx = 0;

    const NOTE = {
      C4:261.63, D4:293.66, E4:329.63, F4:349.23, G4:392.00, A4:440.00, B4:493.88
    };

    const tempo = 160;                // MAIS R√ÅPIDO
    const beatMs = 60000/tempo/2;

    const song = [
      ["E4",2],["E4",2],["E4",4],
      ["E4",2],["E4",2],["E4",4],
      ["E4",2],["G4",2],["C4",2],["D4",2],["E4",6],

      ["F4",2],["F4",2],["F4",2],["F4",2],["F4",4],
      ["E4",2],["E4",2],["E4",2],["E4",2],["E4",4],
      ["D4",2],["D4",2],["E4",2],["D4",2],["G4",6],
    ];

    function musicTick(){
      const [n, beats] = song[songIdx];
      const ms = beats * beatMs;

      tone(NOTE[n], ms*0.95, "triangle", 0.07);
      tone(NOTE[n]*2, Math.min(120, ms*0.33), "sine", 0.020);

      songIdx = (songIdx + 1) % song.length;
      musicTimer = setTimeout(musicTick, ms);
    }

    function startMusic(){
      if (playingMusic) return;
      ensureAudio();
      if (audioCtx.state === "suspended") audioCtx.resume();

      playingMusic = true;
      songIdx = 0;
      beatStep = 0;

      musicTick();
      beatTick();

      if (musicToggle) musicToggle.textContent = "‚è∏Ô∏è M√∫sica";
    }

    function stopMusic(){
      playingMusic = false;
      if (musicTimer) clearTimeout(musicTimer);
      if (beatTimer) clearTimeout(beatTimer);
      musicTimer = null;
      beatTimer = null;
      if (musicToggle) musicToggle.textContent = "üéµ M√∫sica";
    }

    if (musicToggle){
      musicToggle.addEventListener("click", () => {
        if (!playingMusic) startMusic();
        else stopMusic();
      });
    }

    // =========================
    // HINT FLOW + BLOQUEIO REVELAR
    // =========================
    let shown = 1;
    renderHints();

    function renderHints(){
      if (stepTitle){
        stepTitle.textContent = `Pista ${Math.min(shown, CONFIG.hints.length)} de ${CONFIG.hints.length}`;
      }
      if (!pistasEl) return;

      pistasEl.innerHTML = "";
      for (let i=0; i<shown; i++){
        const row = document.createElement("div");
        row.className = "pista";
        row.innerHTML = `<div class="num">${i+1}</div><p>${escapeHtml(CONFIG.hints[i])}</p>`;
        pistasEl.appendChild(row);
      }

      if (nextHint){
        if (shown >= CONFIG.hints.length){
          nextHint.disabled = true;
          nextHint.style.opacity = .7;
          nextHint.style.cursor = "default";
          nextHint.textContent = "Chega de pista ‚úÖ";
        } else {
          nextHint.disabled = false;
          nextHint.style.opacity = 1;
          nextHint.style.cursor = "pointer";
          nextHint.textContent = "Pr√≥xima pista";
        }
      }
    }

    if (nextHint){
      nextHint.addEventListener("click", () => {
        if (shown < CONFIG.hints.length){
          shown++;
          sfxHint(shown);
          renderHints();
        }
      });
    }

    if (revealBtn){
      revealBtn.addEventListener("click", () => {
        if (shown < CONFIG.hints.length){
          sfxError();
          showToast("EEEEEIIIIII, QUE ANSIEDADE TODA √â ESSA? CALMA AE \n\nV√™ as pistas primeiro!");
          return;
        }
        sfxReveal();
        setTimeout(sfxWin, 260);

        if (reveal){
          reveal.style.display = "block";
          reveal.scrollIntoView({ behavior:"smooth", block:"start" });
        }
        launchConfetti();
      });
    }

    function launchConfetti(){
      if (!confetti) return;
      confetti.style.display = "block";
      confetti.innerHTML = "";
      const pieces = 40;
      for (let i=0;i<pieces;i++){
        const el = document.createElement("i");
        const left = Math.random()*100;
        const delay = Math.random()*0.25;
        const duration = 0.95 + Math.random()*0.95;
        const hue = Math.floor(Math.random()*360);

        el.style.left = left + "%";
        el.style.animationDelay = delay + "s";
        el.style.animationDuration = duration + "s";
        el.style.background = `linear-gradient(180deg, hsla(${hue},95%,75%,1), hsla(${hue},95%,75%,0))`;
        el.style.top = "-18px";
        confetti.appendChild(el);
      }
      setTimeout(() => { confetti.style.display = "none"; confetti.innerHTML = ""; }, 1800);
    }
  </script>
</body>
</html>
